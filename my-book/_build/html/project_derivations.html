
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Theoretical Derivations &#8212; NGSolve Shape Optimization</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'project_derivations';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="State equation" href="state_equation.html" />
    <link rel="prev" title="NGSolve Shape Optimization" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="NGSolve Shape Optimization - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="NGSolve Shape Optimization - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    NGSolve Shape Optimization
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Theoretical Derivations</a></li>
<li class="toctree-l1"><a class="reference internal" href="state_equation.html">State equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">Implementation</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cpierer3/shape_optimization/my-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cpierer3/shape_optimization/my-book/issues/new?title=Issue%20on%20page%20%2Fproject_derivations.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/project_derivations.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Theoretical Derivations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1">Exercise 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2">Exercise 2</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i">(i)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ii">(ii)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3">Exercise 3</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">(i)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">(ii)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-extension-to-f-in-h-1-d">(i) Extension to <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ii-extension-to-f-in-h-1-d">(ii) Extension to <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4">Exercise 4</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shape-derivative-of-cost-functional">Shape derivative of cost functional</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-adjoint-equation">The adjoint equation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adjoint-problem">Adjoint problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-expression-for-the-shape-derivative">Final expression for the shape derivative</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5">Exercise 5.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-9b">Exercise 9b.</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="theoretical-derivations">
<h1>Theoretical Derivations<a class="headerlink" href="#theoretical-derivations" title="Link to this heading">#</a></h1>
<p>We want to solve the PDE-constrained shape optimization problem</p>
<div class="math notranslate nohighlight">
\[
\min_{\Omega \subset \mathsf{D}} J(u)
:= \int_\Omega | \nabla u_\Omega - \nabla u_{ref}|^2 \, dx
\]</div>
<p>subject to <span class="math notranslate nohighlight">\((\Omega,u_\Omega)\)</span> satisfying</p>
<div class="math notranslate nohighlight">
\[
\int_\Omega \nabla u_\Omega \cdot \nabla v + u_\Omega v \, dx
=
\int_\Omega f v \, dx
\quad \text{for all } v \in H_0^1(\Omega),
\]</div>
<p>where <span class="math notranslate nohighlight">\(\Omega \subset \mathbb{R}^2\)</span> and
<span class="math notranslate nohighlight">\(u_d, f \in H^2(D)\)</span> and <span class="math notranslate nohighlight">\(\Omega\)</span> belongs to</p>
<div class="math notranslate nohighlight">
\[
\mathcal{A}(D) = \{\Omega \subset D: \Omega \;\text{is measurable and smooth} \}
\]</div>
<section id="exercise-1">
<h2>Exercise 1<a class="headerlink" href="#exercise-1" title="Link to this heading">#</a></h2>
<p>Let <span class="math notranslate nohighlight">\(\Omega\in \mathcal{A}(D)\)</span> and assume <span class="math notranslate nohighlight">\(f, u_{ref} \in C^2(D)\)</span>. We define <span class="math notranslate nohighlight">\(\Theta :=C^1_c(D)^d\)</span> and</p>
<div class="math notranslate nohighlight">
\[
\mathcal{F}(\Theta) := \{I+X: \; X \in \Theta, \; I+X \text{ is bijective, } (I+X)^{-1}\in \Theta \},
\]</div>
<p>where <span class="math notranslate nohighlight">\(I\)</span> denotes the identity. We define the distance to the identity as follows:</p>
<div class="math notranslate nohighlight">
\[
d(I,F):= ||F-I||_\Theta + ||F^{-1}-I||_\Theta, \quad \text{for all } F \in \mathcal{F}(\Theta).
\]</div>
<p>Show that the map <span class="math notranslate nohighlight">\(\bar J: \; \mathcal{F}(\Theta) \to \mathbb{R}, \; F \mapsto J(F(\Omega))\)</span> is continuous at the identity with respect to <span class="math notranslate nohighlight">\(d\)</span>.</p>
<hr class="docutils" />
<p>We want to show: For any sequence <span class="math notranslate nohighlight">\(I_n \in \Theta\)</span> holds: <span class="math notranslate nohighlight">\(d(I, I_n)\xrightarrow{n \to \infty}0 \implies |J(\Omega)-J(I_n(\Omega))|\xrightarrow{n \to \infty} 0\)</span>. So we choose <span class="math notranslate nohighlight">\(I_n\)</span> with <span class="math notranslate nohighlight">\(d(I, I_n)\xrightarrow{n \to \infty}0\)</span>, which means <span class="math notranslate nohighlight">\(||I-I_n||_\Theta, \; ||I-I^{-1}||_\Theta \xrightarrow{n \to \infty}0\)</span>. Therefore we also know <span class="math notranslate nohighlight">\(\Omega_n := I_n(\Omega) \xrightarrow{n \to \infty}\Omega.\)</span></p>
<p>We have</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\bar J (I) = J(\Omega)= \int_{\Omega} |\nabla u_\Omega - \nabla u_{ref}|^2 dx \\
\bar J (I_n) = J(\Omega_n)= \int_{\Omega_n} |\nabla u_{\Omega_n} - \nabla u_{ref}|^2 dx,
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(u_\Omega\)</span> solves</p>
<p>\begin{equation}
\int_{\Omega} \nabla u_\Omega \cdot \nabla \varphi + u_\Omega \varphi dx = \int_{\Omega} f \varphi dx \quad \forall \varphi \in H_0^1(\Omega)
\end{equation}</p>
<p>and <span class="math notranslate nohighlight">\(u_{\Omega_n}\)</span> solves</p>
<div class="math notranslate nohighlight">
\[
\int_{\Omega_n} \nabla u_{\Omega_n} \cdot \nabla \varphi + u_{\Omega_n} \varphi dx = \int_{\Omega_n} f \varphi dx \quad \forall \varphi \in H_0^1(\Omega_n).
\]</div>
<p>We want to show that <span class="math notranslate nohighlight">\(u_n:=u_{\Omega_n} \circ I_n|_\Omega\)</span> converges to <span class="math notranslate nohighlight">\(u_\Omega\)</span> with <span class="math notranslate nohighlight">\(n \to \infty\)</span>:</p>
<p>Per definition is <span class="math notranslate nohighlight">\(u_n\)</span> a function in <span class="math notranslate nohighlight">\(H_0^1(\Omega)\)</span> for all <span class="math notranslate nohighlight">\(n\)</span> and from the chain rule follows:</p>
<div class="math notranslate nohighlight">
\[
\nabla_{y} u_{\Omega_n}(y)=(\nabla_{x}I_n)^{-\top}\cdot \nabla_{x} u_n(x)
\]</div>
<p>for <span class="math notranslate nohighlight">\(y:=I_n(x)\)</span>. Using this we get</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\int_{\Omega_n} |\nabla u_{\Omega_n} - \nabla u_{ref}|^2 dx =\\
\int_{\Omega}|\text{det }d I_n|\cdot [(\nabla I_n)^{-\top} \nabla u_n) \cdot (\nabla I_n)^{-\top} (\nabla \varphi) \circ I_n) + u_n \varphi \circ I_n] dy
\end{split}\]</div>
<p>for all <span class="math notranslate nohighlight">\(\varphi \in H_0^1(\Omega_n)\)</span>. So the weak formulation for <span class="math notranslate nohighlight">\(u_n\)</span> becomes</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\int_{\Omega}\underset{\to 1 \text{ uniformly}}{\underbrace{|\text{det }d I_n|}}\cdot [\underset{\to I \text{ uniformly}}{\underbrace{(\nabla I_n)^{-\top}}} \nabla u_n \cdot  \nabla \varphi + u_n \varphi] dy=\\
\int_{\Omega}\underset{\to 1 \text{ uniformly}}{\underbrace{|\text{det }d I_n|}}\cdot \underset{\to f \text{ uniformly}}{\underbrace{f \circ I_n}} \varphi dy \quad \forall \varphi \in H_0^1(\Omega)
\end{split}\]</div>
<p>So taking the limit we get</p>
<div class="math notranslate nohighlight">
\[
\int_{\Omega_n} \nabla \text{lim}_n u_{n} \cdot \nabla \varphi + \text{lim}_n u_{n} \varphi dx = \int_{\Omega_n} f \varphi dx \quad \forall \varphi \in H_0^1(\Omega).
\]</div>
<p>and from (1) we get <span class="math notranslate nohighlight">\(u_n \xrightarrow{n \to \infty} u_\Omega\)</span> and <span class="math notranslate nohighlight">\(\nabla u_{\Omega_n} \xrightarrow{n \to \infty} \nabla u_\Omega\)</span>. With that we see</p>
<div class="math notranslate nohighlight">
\[\begin{split}
J(I_n(\Omega))=\int_{\Omega_n}|\nabla u_{\Omega_n}-\nabla u_{ref}|^2 dx = \int_{\Omega} |\text{det }d I_n| \cdot |(\nabla u_{\Omega_n}) \circ I_n - (\nabla u_{ref}) \circ I_n|^2 dx \\
\xrightarrow{n \to \infty} \int_{\Omega} |\nabla u_\Omega - \nabla u_{ref}|^2 dx = J(\Omega)
\end{split}\]</div>
</section>
<section id="exercise-2">
<h2>Exercise 2<a class="headerlink" href="#exercise-2" title="Link to this heading">#</a></h2>
<p>Let <span class="math notranslate nohighlight">\(F_t(x) := x + t X(x) \text{ for } t &gt; 0 \text{ small},\)</span> where <span class="math notranslate nohighlight">\(X \in C_c^1(D)^d\)</span>.</p>
<p>We define
$<span class="math notranslate nohighlight">\(
\xi(t) := \det(\nabla F_t), \qquad
\psi(t) := \nabla F_t^{-1} \nabla F_t^{-\top}.
\)</span>$</p>
<p>Show that</p>
<p>(i) <span class="math notranslate nohighlight">\(\quad  \displaystyle \left. \partial_t \xi(t) \right|_{t=0} = \operatorname{div}(X)\)</span><br />
(ii) <span class="math notranslate nohighlight">\(\quad  \displaystyle \left. \partial_t \psi(t) \right|_{t=0} = -(\nabla X + \nabla X^\top)\)</span></p>
<hr class="docutils" />
<section id="i">
<h3>(i)<a class="headerlink" href="#i" title="Link to this heading">#</a></h3>
<p>We first observe that <span class="math notranslate nohighlight">\(\nabla F_t = I + t \nabla X.\)</span></p>
<p>Let <span class="math notranslate nohighlight">\(A(t) := \nabla F_t\)</span>. Using the identity
$<span class="math notranslate nohighlight">\(
\frac{d}{dt} \det A(t)
= \det A(t) \cdot \mathrm{tr}\!\left(A(t)^{-1} \frac{dA(t)}{dt}\right),
\)</span><span class="math notranslate nohighlight">\(
we obtain
\)</span><span class="math notranslate nohighlight">\(
\partial_t \xi(t)
= \det(\nabla F_t)\cdot
\mathrm{tr}\!\left((\nabla F_t)^{-1} \partial_t \nabla F_t\right).
\)</span>$</p>
<p>Since <span class="math notranslate nohighlight">\(\partial_t \nabla F_t = \nabla X\)</span>, we get
$<span class="math notranslate nohighlight">\(
\partial_t \xi(0)
= \det(I)\, \mathrm{tr}(I \nabla X)
= \mathrm{tr}(\nabla X)
= \operatorname{div}(X).
\)</span>$</p>
<section id="ii">
<h4>(ii)<a class="headerlink" href="#ii" title="Link to this heading">#</a></h4>
<p>We use the identity
$<span class="math notranslate nohighlight">\(
\frac{d}{dt} A^{-1}(t)
= -A^{-1}(t)\, \frac{dA(t)}{dt}\, A^{-1}(t).
\)</span>$</p>
<p>Thus,
$<span class="math notranslate nohighlight">\(
\partial_t \nabla F_t^{-1}
= -\nabla F_t^{-1} (\frac{d F_t(t)}{dt}) \nabla F_t^{-1} = -(I+t \nabla X)^{-1} \nabla X (I+ t \nabla X)^{-1}.
\)</span>$</p>
<p>Evaluating at <span class="math notranslate nohighlight">\(t = 0\)</span> yields
$<span class="math notranslate nohighlight">\(
\partial_t \nabla F_t^{-1}\big|_{t=0} = -\nabla X.
\)</span>$</p>
<p>Now,
$$
\partial_t \psi(t)
= (\partial_t \nabla F_t^{-1}) \nabla F_t^{-\top}</p>
<ul class="simple">
<li><p>\nabla F_t^{-1} (\partial_t \nabla F_t^{-\top}).
$$</p></li>
</ul>
<p>At <span class="math notranslate nohighlight">\(t = 0\)</span> we have <span class="math notranslate nohighlight">\(\nabla F_0^{-1} = I\)</span> and
$<span class="math notranslate nohighlight">\(
\partial_t \nabla F_t^{-\top}\big|_{t=0} = -(\nabla X)^\top.
\)</span>$</p>
<p>Therefore,
$<span class="math notranslate nohighlight">\(
\partial_t \psi(0)
= -\nabla X - (\nabla X)^\top.
\)</span>$</p>
</section>
</section>
</section>
<section id="exercise-3">
<h2>Exercise 3<a class="headerlink" href="#exercise-3" title="Link to this heading">#</a></h2>
<p>Let <span class="math notranslate nohighlight">\(D \subset \mathbb{R}^d\)</span> and <span class="math notranslate nohighlight">\(F_t(x) := x + tX(x)\)</span> for <span class="math notranslate nohighlight">\(t &gt; 0\)</span> small, where <span class="math notranslate nohighlight">\(X \in C_c^1(D)^d\)</span>. Let <span class="math notranslate nohighlight">\(f^t := f \circ F_t\)</span>, where <span class="math notranslate nohighlight">\(f \in C^2(D)\)</span>. Show that:</p>
<p>(i) <span class="math notranslate nohighlight">\(\quad f_t \to f\)</span> in <span class="math notranslate nohighlight">\(L_2(D)\)</span> for <span class="math notranslate nohighlight">\(t \searrow 0\)</span>.</p>
<p>(ii) <span class="math notranslate nohighlight">\(\quad \frac{f_t - f}{t} \to \nabla f \cdot X\)</span> in <span class="math notranslate nohighlight">\(L_2(D)\)</span> for <span class="math notranslate nohighlight">\(t \searrow 0\)</span>.</p>
<p>Argue by density properties that the previous convergences hold for <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span>.</p>
<hr class="docutils" />
<section id="id1">
<h3>(i)<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>First we observe that <span class="math notranslate nohighlight">\((f(x + tX(x)) - f(x))|_{(\text{supp}X)^c}=0\)</span>. Using this we see</p>
<div class="math notranslate nohighlight">
\[
\|f_t - f\|_{L_2(D)}^2 = \int_{\text{supp } X} (f(x + tX(x)) - f(x))^2 \, dx
\]</div>
<p>As <span class="math notranslate nohighlight">\(t \to 0\)</span>, <span class="math notranslate nohighlight">\(f(x + tX(x)) \to f(x)\)</span> pointwise due to the continuity of <span class="math notranslate nohighlight">\(f\)</span>. Because <span class="math notranslate nohighlight">\(X\)</span> has compact support, it follows from the Dominated Convergence Theorem:</p>
<div class="math notranslate nohighlight">
\[
\lim_{t \to 0} \int_{\text{supp } X} |f(x + tX(x)) - f(x)|^2 dx = \int_{\text{supp } X} |f(x)-f(x)|^2 dx = 0
\]</div>
</section>
<section id="id2">
<h3>(ii)<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>Using Taylor’s expansion for <span class="math notranslate nohighlight">\(f(F_t(x))\)</span>:</p>
<div class="math notranslate nohighlight">
\[
f(F_t(x)) = f(x) + t \nabla f(x) \cdot X(x) + \frac{t^2}{2} \sum_{|\alpha|=2} \frac{\partial^\alpha f}{\partial x^\alpha}(\xi) (X(x))^\alpha
\]</div>
<p>Rearranging for the difference quotient:</p>
<div class="math notranslate nohighlight">
\[
\frac{f_t - f}{t} - \nabla f \cdot X = \frac{t}{2} \sum_{|\alpha|=2} \frac{\partial^\alpha f}{\partial x^\alpha}(\xi) (X(x))^\alpha
\]</div>
<p>Since <span class="math notranslate nohighlight">\(f \in C^2\)</span> and <span class="math notranslate nohighlight">\(X\)</span> is compactly supported, the second-order term is bounded. Thus:</p>
<div class="math notranslate nohighlight">
\[
\lim_{t \to 0} \left\| \frac{f_t - f}{t} - \nabla f \cdot X \right\|_{L_2} = \lim_{t \to 0} \frac{t}{2} \left\| \sum_{|\alpha|=2} \frac{\partial^\alpha f}{\partial x^\alpha}(\xi) X^\alpha \right\|_{L_2} = 0
\]</div>
</section>
<section id="i-extension-to-f-in-h-1-d">
<h3>(i) Extension to <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span><a class="headerlink" href="#i-extension-to-f-in-h-1-d" title="Link to this heading">#</a></h3>
<p>We want to show that <span class="math notranslate nohighlight">\(f \mapsto f^t\)</span> is bounded in <span class="math notranslate nohighlight">\(L_2\)</span>. We observe that <span class="math notranslate nohighlight">\(\text{det }(dF_t^{-1}) \xrightarrow{t \to 0}1\)</span> uniformly. So we can choose <span class="math notranslate nohighlight">\(t\)</span> small enough such that <span class="math notranslate nohighlight">\(det(dF_t^{-1}) \leq 2\)</span>. <span class="math notranslate nohighlight">\(F_t\)</span> is also a diffeomorphism for <span class="math notranslate nohighlight">\(t\)</span> small enough.</p>
<div class="math notranslate nohighlight">
\[
||f^t||_{L_2}^2 = \int_{D}(f \circ F_t)^2 dx = \int_{F_t(D)} |\text{det } dF_t^{-1}| \cdot f^2 dy \leq 2 ||f||_{L_2}^2
\]</div>
<p>Choose a sequence <span class="math notranslate nohighlight">\((f_n) \subset C^\infty(D)\)</span> such that <span class="math notranslate nohighlight">\(\|f_n - f\|_{H^1(D)} \to 0\)</span>.
For any <span class="math notranslate nohighlight">\(\epsilon &gt; 0\)</span>, we decompose the error:</p>
<div class="math notranslate nohighlight">
\[
||f^t-f||_{L_2} \leq ||f^t-f^t_n||_{L_2} + ||f^t_n-f_n||_{L_2} + ||f_n-f||_{L_2}
\]</div>
<ol class="arabic simple">
<li><p>We just showed that the first term is <span class="math notranslate nohighlight">\(&lt; C \epsilon\)</span>.</p></li>
<li><p>The second term <span class="math notranslate nohighlight">\(\to 0\)</span> as <span class="math notranslate nohighlight">\(t \to 0\)</span> since <span class="math notranslate nohighlight">\(f_n\)</span> is smooth.</p></li>
<li><p>The third term is <span class="math notranslate nohighlight">\(&lt; \epsilon\)</span> by the <span class="math notranslate nohighlight">\(H^1\)</span> convergence of <span class="math notranslate nohighlight">\(f_n\)</span>.</p></li>
</ol>
<p>Since <span class="math notranslate nohighlight">\(\epsilon\)</span> is arbitrary, the result holds for all <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span>.</p>
</section>
<section id="ii-extension-to-f-in-h-1-d">
<h3>(ii) Extension to <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span><a class="headerlink" href="#ii-extension-to-f-in-h-1-d" title="Link to this heading">#</a></h3>
<p>We define <span class="math notranslate nohighlight">\(T_t f = \frac{f^t - f}{t}\)</span> and show it is bounded in <span class="math notranslate nohighlight">\(H^1\)</span>. By the Fundamental Theorem of Calculus:</p>
<div class="math notranslate nohighlight">
\[
f(x + tX(x)) - f(x) = \int_0^1 \nabla f(x + stX(x)) \cdot tX(x) ds
\]</div>
<p>Since <span class="math notranslate nohighlight">\(X \in C^1_c(D)^d\)</span> we know that there exists an upper bound <span class="math notranslate nohighlight">\(M\)</span> for <span class="math notranslate nohighlight">\(X\)</span>. So we obtain</p>
<div class="math notranslate nohighlight">
\[
\|T_t f\|_{L_2(D)} \leq M \int_0^1 \|\nabla f(x + stX(x))\|_{L_2(D)} ds
\]</div>
<p>Using the change of variables <span class="math notranslate nohighlight">\(\Phi_s(x) = x + stX(x)\)</span>, which is a diffeomorphism for small <span class="math notranslate nohighlight">\(t\)</span>. We choose <span class="math notranslate nohighlight">\(t\)</span> small enough such that <span class="math notranslate nohighlight">\(|det(d\Phi_s^{-1})| \leq 2\)</span>. We can do that because <span class="math notranslate nohighlight">\(|det(d\Phi_s^{-1})| = |det(I)| = 1\)</span> for <span class="math notranslate nohighlight">\(t=0\)</span>. We also observe that <span class="math notranslate nohighlight">\(\Phi_s(D) \subseteq D\)</span> holds.</p>
<div class="math notranslate nohighlight">
\[
\int_D ||\nabla f(\Phi_s(x))||^2 dx = \int_{\Phi_s(D)} |det(d\Phi_s^{-1})| \cdot||\nabla f(y)||^2 dx \leq 2 \int_D ||\nabla f(y)||^2 dy
\]</div>
<p>This gives the uniform bound independent of <span class="math notranslate nohighlight">\(t\)</span>:
$<span class="math notranslate nohighlight">\(
\|T_t f\|_{L_2(D)} \leq \sqrt{2} M \|\nabla f\|_{L_2(D)}
\)</span>$</p>
<p>Choose a sequence <span class="math notranslate nohighlight">\((f_n) \subset C^\infty(D)\)</span> such that <span class="math notranslate nohighlight">\(\|f_n - f\|_{H^1(D)} \to 0\)</span>.
For any <span class="math notranslate nohighlight">\(\epsilon &gt; 0\)</span>, we decompose the error:</p>
<div class="math notranslate nohighlight">
\[
\left\| \frac{f^t - f}{t} - \nabla f \cdot X \right\|_{L_2} \leq \left\| T_t(f - f_n) \right\|_{L_2} + \left\| T_t f_n - \nabla f_n \cdot X \right\|_{L_2} + \| (\nabla f_n - \nabla f) \cdot X \|_{L_2}
\]</div>
<ol class="arabic simple">
<li><p>We just showed that the first term is <span class="math notranslate nohighlight">\(&lt; C \epsilon\)</span>.</p></li>
<li><p>The second term <span class="math notranslate nohighlight">\(\to 0\)</span> as <span class="math notranslate nohighlight">\(t \to 0\)</span> since <span class="math notranslate nohighlight">\(f_n\)</span> is smooth.</p></li>
<li><p>The third term is <span class="math notranslate nohighlight">\(&lt; M \epsilon\)</span> by the <span class="math notranslate nohighlight">\(H^1\)</span> convergence of <span class="math notranslate nohighlight">\(f_n\)</span>.</p></li>
</ol>
<p>Since <span class="math notranslate nohighlight">\(\epsilon\)</span> is arbitrary, the result holds for all <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span>.</p>
</section>
</section>
<section id="exercise-4">
<h2>Exercise 4<a class="headerlink" href="#exercise-4" title="Link to this heading">#</a></h2>
<p>Use the direct method to compute the derivative</p>
<div class="math notranslate nohighlight">
\[
DJ(\Omega)(X) = \lim _{t \downarrow 0} \frac{J(\Omega_t) - J(\Omega)}{t}
\]</div>
<hr class="docutils" />
<p>Considering the perturbed state equation</p>
<div class="math notranslate nohighlight">
\[
\int_{\Omega_t} \nabla u_{\Omega_t} \cdot \nabla \varphi
+ u_{\Omega_t}\,\varphi
=
\int_{\Omega_t} f \varphi
\qquad \forall \varphi \in H^1_0(\Omega_t),
\]</div>
<p>a change of variables with <span class="math notranslate nohighlight">\(F_t(x) = y\)</span> yields</p>
<div class="math notranslate nohighlight">
\[
\int_\Omega A(t)\nabla u_t \cdot \nabla \varphi_t
+ \int_\Omega \xi(t)u_t \varphi_t
=
\int_\Omega \xi(t) f_t \varphi_t.
\]</div>
<p>Here,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
A(t) &amp;= \det(\partial F_t)\, \partial F_t^{-1}\partial F_t^{-\top}, \\
\xi(t) &amp;= \det(\partial F_t), \\
u_t &amp;= u_{\Omega_t} \circ F_t, \\
\varphi_t &amp;= \varphi \circ F_t, \\
f_t &amp;= f \circ F_t.
\end{aligned}
\end{split}\]</div>
<p>Using the identity</p>
<div class="math notranslate nohighlight">
\[
\nabla v \circ F_t = \partial F_t^{-\top}\nabla (v \circ F_t),
\]</div>
<p>and replacing the test function (space) accordingly, we obtain</p>
<div class="math notranslate nohighlight">
\[
\int_\Omega A(t)\nabla u_t \cdot \nabla \psi
+ \int_\Omega \xi(t)u_t \psi
=
\int_\Omega \xi(t) f_t \psi
\qquad \forall \psi \in H^1_0(\Omega).
\]</div>
<p>Differentiating with respect to <span class="math notranslate nohighlight">\(t\)</span> and evaluating at <span class="math notranslate nohighlight">\(t=0\)</span> yields</p>
<div class="math notranslate nohighlight">
\[
\int_\Omega A'(0)\nabla u \cdot \nabla \psi
+ \int_\Omega \nabla \dot{u} \cdot \nabla \psi
+ \int_\Omega \operatorname{div}(X) u \psi
+ \int_\Omega \dot{u}\,\psi
=
\int_\Omega \operatorname{div}(X)f\psi
+ \int_\Omega \nabla f \cdot X\,\psi.
\]</div>
<p>With</p>
<div class="math notranslate nohighlight">
\[
A'(0) = \operatorname{div}(X)\,I - \partial X - \partial X^\top,
\]</div>
<p>we obtain</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\int_\Omega \nabla \dot{u} \cdot \nabla \psi
+ \int_\Omega \dot{u}\,\psi
&amp;=
- \int_\Omega \operatorname{div}(X) u \psi \\
&amp;\quad
- \int_\Omega
\bigl(\operatorname{div}(X)I - \partial X - \partial X^\top\bigr)
\nabla u \cdot \nabla \psi \\
&amp;\quad
+ \int_\Omega (\nabla f \cdot X)\,\psi \\
&amp;\quad + \int_\Omega \operatorname{div}(X)f\psi.
\end{aligned}
\tag{2}
\end{split}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\dot{u}\)</span> denotes the <strong>material derivative</strong> of <span class="math notranslate nohighlight">\(u\)</span>.<br />
Following the approach of Lemma 4.217 (adapted to our setting), we obtain
$$</p>
<p>\dot{u} \in H^1_0(\Omega).</p>
<p>$$</p>
<section id="shape-derivative-of-cost-functional">
<h3>Shape derivative of cost functional<a class="headerlink" href="#shape-derivative-of-cost-functional" title="Link to this heading">#</a></h3>
<p>We differentiate <span class="math notranslate nohighlight">\(t \mapsto J(\Omega_t)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
DJ(\Omega)(X)
&amp;= \left.\frac{d}{dt} J(\Omega_t)\right|_{t=0} \\
&amp;= \left.\frac{d}{dt} \int_\Omega
\det(\partial F_t)\,|\nabla u_t - \nabla u_{\mathrm{ref}}|^2 \right|_{t=0} \\
&amp;= \int_\Omega \operatorname{div}(X)|\nabla u - \nabla u_{\mathrm{ref}}|^2
+ 2 \int_\Omega \nabla \dot{u} \cdot (\nabla u - \nabla u_{\mathrm{ref}}) \\
&amp;\quad
- 2 \int_\Omega (\nabla u - \nabla u_{\mathrm{ref}}) \nabla^2 u_{\mathrm{ref}} \cdot X.
\end{aligned}
\tag{3}
\end{split}\]</div>
</section>
<section id="the-adjoint-equation">
<h3>The adjoint equation<a class="headerlink" href="#the-adjoint-equation" title="Link to this heading">#</a></h3>
<p>To eliminate the explicit occurrence of the material derivative <span class="math notranslate nohighlight">\(\dot{u}\)</span>,
we introduce the Lagrangian</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L} :
\mathbb{R} \times H^1_0(\Omega) \times H^1_0(\Omega)
\rightarrow \mathbb{R},
\]</div>
<p>defined by</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}(t,u,p)
=
\int_\Omega A(t)\nabla u \cdot \nabla p
+ \int_\Omega \xi(t) u p
- \int_\Omega \xi(t)f_t p
+ \int_\Omega (A(t)(\nabla u - \nabla u_{\mathrm{ref},t})) \cdot (\nabla u - \nabla u_{\mathrm{ref},t}).
\]</div>
<p>The formal Lagrangian approach (see Tröltzsch) suggests that the adjoint
<span class="math notranslate nohighlight">\(p\)</span> satisfies</p>
<div class="math notranslate nohighlight">
\[
\partial_u \mathcal{L}(0,u,p)(\psi) = 0
\qquad \forall \psi \in H^1_0(\Omega).
\]</div>
<p>Computing the derivative yields</p>
<div class="math notranslate nohighlight">
\[
\partial_u \mathcal{L}(0,u,p)(\psi)
=
\int_\Omega \nabla \psi \cdot \nabla p
+ \int_\Omega \psi p
+ 2 \int_\Omega (\nabla u - \nabla u_{\mathrm{ref}}) \cdot \nabla\psi.
\]</div>
</section>
<section id="adjoint-problem">
<h3>Adjoint problem<a class="headerlink" href="#adjoint-problem" title="Link to this heading">#</a></h3>
<p>We define the adjoint solution <span class="math notranslate nohighlight">\(p \in H^1_0(\Omega)\)</span> by</p>
<div class="math notranslate nohighlight">
\[
\int_\Omega \nabla \psi \cdot \nabla p
+ \int_\Omega \psi p
=
-2 \int_\Omega (\nabla u - \nabla u_{\mathrm{ref}}) \cdot \nabla\psi
\qquad \forall \psi \in H^1_0(\Omega).
\tag{4}
\]</div>
<p>Choosing <span class="math notranslate nohighlight">\(\psi = \dot{u}\)</span> in (4) gives</p>
<div class="math notranslate nohighlight">
\[
\int_\Omega \nabla \dot{u} \cdot \nabla p
+ \int_\Omega \dot{u} p
=
-2 \int_\Omega (\nabla u - \nabla u_{\mathrm{ref}}) \cdot \nabla\dot u.
\]</div>
<p>On the other hand, choosing <span class="math notranslate nohighlight">\(\psi = p\)</span> in (2) yields</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\int_\Omega \nabla \dot{u} \cdot \nabla p
+ \int_\Omega \dot{u}\,p
&amp;=
- \int_\Omega \operatorname{div}(X) u p \\
&amp;\quad
- \int_\Omega
\bigl(\operatorname{div}(X)I - \partial X - \partial X^\top\bigr)
\nabla u \cdot \nabla p \\
&amp;\quad
+ \int_\Omega (\nabla f \cdot X)\,p \\
&amp;\quad + \int_\Omega \operatorname{div}(X)fp.
\end{aligned}
\end{split}\]</div>
<p>Combining both identities yields</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
2 \int_\Omega (\nabla u - \nabla u_{\mathrm{ref}}) \cdot \nabla\dot u
&amp;=
\int_\Omega \operatorname{div}(X) u p \\
&amp;\quad
+ \int_\Omega
\bigl(\operatorname{div}(X)I - \partial X - \partial X^\top\bigr)
\nabla u \cdot \nabla p \\
&amp;\quad
- \int_\Omega (\nabla f \cdot X)\,p \\
&amp; \quad
- \int_\Omega \operatorname{div}(X)f p
\end{aligned}
\tag{5}
\end{split}\]</div>
</section>
<section id="final-expression-for-the-shape-derivative">
<h3>Final expression for the shape derivative<a class="headerlink" href="#final-expression-for-the-shape-derivative" title="Link to this heading">#</a></h3>
<p>Inserting (5) into (3) yields</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
DJ(\Omega)(X)
&amp;=
\int_\Omega \operatorname{div}(X)|\nabla u - \nabla u_{\mathrm{ref}}|^2
- 2 \int_\Omega (\nabla u - \nabla u_{\mathrm{ref}}) \nabla^2 u_{\mathrm{ref}} \cdot X\\
&amp;\quad
+ \int_\Omega \operatorname{div}(X) u p \\
&amp;\quad
+ \int_\Omega
\bigl(\operatorname{div}(X)I - \partial X - \partial X^\top\bigr)
\nabla u \cdot \nabla p \\
&amp;\quad
- \int_\Omega (\nabla f \cdot X)\,p\\
&amp; \quad
- \int_\Omega \operatorname{div}(X)fp .
\end{aligned}
\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(u = u_0\)</span>.</p>
</section>
</section>
<section id="exercise-5">
<h2>Exercise 5.<a class="headerlink" href="#exercise-5" title="Link to this heading">#</a></h2>
<p>Use the average adjoint method to compute the derivate</p>
<div class="math notranslate nohighlight">
\[
DJ(\Omega)(X) = \lim _{t \downarrow 0} \frac{J(\Omega_t) - J(\Omega)}{t}
\]</div>
<hr class="docutils" />
<p>Considering the parametrised Lagrangian</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}(t,u,p)
=
\int_\Omega A(t)\nabla u \cdot \nabla p
+ \int_\Omega \xi(t) u p
- \int_\Omega \xi(t)f_t p
+ \int_\Omega (A(t)(\nabla u - \nabla u_{\mathrm{ref},t})) \cdot (\nabla u - \nabla u_{\mathrm{ref},t}).
\]</div>
<p>we define the average adjoint <span class="math notranslate nohighlight">\(p^t \in H^1_0(\Omega)\)</span> as the solution to</p>
<div class="math notranslate nohighlight">
\[
\int_0^1 \partial _u \mathcal{L}(t, s u_t + (1-s)u_0, p^t)(v) ds = 0 \quad \forall v \in H^1_0(\Omega)
\]</div>
<p>Similar to Lemma 3.63 we get</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}(t, u_t, 0) - \mathcal{L}(0, u_0, 0) = \mathcal{L}(t, u_0, p^t) - \mathcal{L}(0, u_0, p^t)
\]</div>
<p>Therefore we have</p>
<div class="math notranslate nohighlight">
\[
DJ(\Omega)(X) = \lim _ {t \downarrow 0} \frac{J(\Omega_t) - J(\Omega)}{t} = \lim _ {t \downarrow 0} \frac{\mathcal{L}(t, y^t, 0)- \mathcal{L}(0, y^0, 0)} =\lim _{t \downarrow 0} \frac{\mathcal{L}(t, u_0, p^t) - \mathcal{L}(0, u_0, p^t)}{t} 
\]</div>
<p>Since</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\frac{\mathcal{L}(t, u_0, p^t) - \mathcal{L}(0, u_0, p^t)}{t} &amp;= \int _\Omega \frac{A(t) - \operatorname{I}}{t} \nabla u_0 \cdot \nabla p^t \\
                                                    &amp;+ \int _\Omega \frac{\xi(t)- 1}{t} u_0 p^t \\
                                                    &amp;- \int _\Omega \frac{\xi(t)f_t-1 \cdot f_0}{t} p^t \\
                                                    &amp;+ \int_\Omega \frac{(A(t)(\nabla u_0 - \nabla u_{\mathrm{ref},t})) \cdot (\nabla u_0 - \nabla u_{\mathrm{ref},t}) - (\nabla u_0 - u_{ref}) \cdot (\nabla u_0 - u_{ref})}{t}
                                        
\end{aligned}
\end{split}\]</div>
<p>Therefore</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{split}
\begin{aligned}
DJ(\Omega)(X) &amp;= \int _\Omega A'(0) \nabla u_0 \cdot \nabla p ^0 \\
                &amp; + \int _\Omega \xi'(0) u_0 p^0 \\
                &amp; - \int _\Omega \partial _t f_t\bigg |_{t=0} \xi(0) p ^0\\
                &amp; - \int _\Omega \xi'(0) f p^0 \\
                &amp; + \int _\Omega \frac{d}{dt}(A(t)(\nabla u_0 - \nabla u_{\mathrm{ref},t})) \cdot (\nabla u_0 - \nabla u_{\mathrm{ref},t}) \bigg |_{t=0}\end{split}\\
\end{aligned}
\end{aligned}\end{align} \]</div>
<p>with exercise 2 we get</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
DJ(\Omega)(X)
&amp;=
\int_\Omega (\operatorname{div}(X))|\nabla u - \nabla u_{\mathrm{ref}}|^2
- 2 \int_\Omega (\nabla u - \nabla u_{\mathrm{ref}}) \nabla^2 u_{\mathrm{ref}} \cdot X\\
&amp;\quad
+ \int_\Omega \operatorname{div}(X) u p \\
&amp;\quad
+ \int_\Omega
\bigl(\operatorname{div}(X)I - \partial X - \partial X^\top\bigr)
\nabla u \cdot \nabla p \\
&amp;\quad
- \int_\Omega (\nabla f \cdot X)\,p\\
&amp; \quad
- \int_\Omega \operatorname{div}(X)fp .
\end{aligned}
\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(p^0 = p, u_0 = u\)</span>.</p>
</section>
<section id="exercise-9b">
<h2>Exercise 9b.<a class="headerlink" href="#exercise-9b" title="Link to this heading">#</a></h2>
<p>find X by solving</p>
<div class="math notranslate nohighlight">
\[
\min _{X \in H^1(\Omega)^2} \frac{1}{p} \int _D  |\nabla X | ^p dx - DJ(\Omega) (X)
\]</div>
<hr class="docutils" />
<p>This p -Laplacian can be rewritten by the formulation</p>
<div class="math notranslate nohighlight">
\[
 \int _D |\nabla(X)| ^{p-2} \nabla X :\nabla Y dx - DJ(\Omega)(Y) = 0 \qquad \forall Y \in H^1_0(D)^2
\]</div>
<p>which is a nonlinear equation in X and requires therefore something like Newton’s method.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">NGSolve Shape Optimization</p>
      </div>
    </a>
    <a class="right-next"
       href="state_equation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">State equation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1">Exercise 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2">Exercise 2</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i">(i)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ii">(ii)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3">Exercise 3</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">(i)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">(ii)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-extension-to-f-in-h-1-d">(i) Extension to <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ii-extension-to-f-in-h-1-d">(ii) Extension to <span class="math notranslate nohighlight">\(f \in H^1(D)\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4">Exercise 4</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shape-derivative-of-cost-functional">Shape derivative of cost functional</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-adjoint-equation">The adjoint equation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adjoint-problem">Adjoint problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-expression-for-the-shape-derivative">Final expression for the shape derivative</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5">Exercise 5.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-9b">Exercise 9b.</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Constantin Pierer
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>